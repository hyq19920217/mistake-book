import{r as c,l as H,E as m,c as C,e as s,b as l,w as a,d as r,o as y,f as p,F as L,m as q,i as z,g as A,h as I,t as k,n as j}from"./index-BMI1Flys.js";import{u as G}from"./notebook-DlYxDQa4.js";import{_ as J}from"./_plugin-vue_export-helper-DlAUqK2U.js";const K={class:"home-container"},O={class:"header"},P={class:"notebook-content"},Q={class:"description"},W={class:"meta"},X={class:"notebook-footer"},Y={class:"dialog-footer"},Z={__name:"Home",setup(ee){const V=A(),i=G(),u=c(!1),_=c(!1),f=c(!1),v=c(null),g=c(null),n=c({name:"",description:""}),N={name:[{required:!0,message:"请输入错题本名称",trigger:"blur"},{max:50,message:"名称不能超过50个字符",trigger:"blur"}],description:[{max:200,message:"描述不能超过200个字符",trigger:"blur"}]};H(async()=>{try{await i.fetchNotebooks()}catch{m.error("获取错题本列表失败")}});const h=t=>new Date(t).toLocaleDateString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}),B=()=>{f.value=!1,v.value=null,n.value={name:"",description:""},u.value=!0},D=t=>{f.value=!0,v.value=t,n.value={name:t.name,description:t.description},u.value=!0},E=t=>{i.setCurrentNotebook(t),V.push(`/notebook/${t._id}`)},S=async t=>{try{await j.confirm("确定要删除这个错题本吗？此操作不可恢复。","警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await i.deleteNotebook(t._id),m.success("删除成功")}catch(e){e!=="cancel"&&m.error("删除失败")}},$=async()=>{if(g.value)try{await g.value.validate(),_.value=!0,f.value?(await i.updateNotebook(v.value._id,n.value),m.success("更新成功")):(await i.createNotebook(n.value),m.success("创建成功")),u.value=!1}catch(t){console.error(t),m.error(f.value?"更新失败":"创建失败")}finally{_.value=!1}};return(t,e)=>{const d=r("el-button"),M=r("el-card"),R=r("el-col"),T=r("el-row"),b=r("el-input"),x=r("el-form-item"),U=r("el-form"),F=r("el-dialog");return y(),C("div",K,[s("div",O,[e[5]||(e[5]=s("h2",null,"我的错题本",-1)),l(d,{type:"primary",onClick:B},{default:a(()=>e[4]||(e[4]=[p(" 新建错题本 ")])),_:1})]),l(T,{gutter:20,class:"notebook-list"},{default:a(()=>[(y(!0),C(L,null,q(z(i).notebooks,o=>(y(),I(R,{key:o._id,xs:24,sm:12,md:8,lg:6},{default:a(()=>[l(M,{class:"notebook-card","body-style":{padding:"0px"}},{default:a(()=>[s("div",P,[s("h3",null,k(o.name),1),s("p",Q,k(o.description||"暂无描述"),1),s("div",W,[s("span",null,"更新时间："+k(h(o.updatedAt)),1)])]),s("div",X,[l(d,{text:"",onClick:w=>D(o)},{default:a(()=>e[6]||(e[6]=[p("编辑")])),_:2},1032,["onClick"]),l(d,{text:"",onClick:w=>E(o)},{default:a(()=>e[7]||(e[7]=[p("查看")])),_:2},1032,["onClick"]),l(d,{text:"",type:"danger",onClick:w=>S(o)},{default:a(()=>e[8]||(e[8]=[p("删除")])),_:2},1032,["onClick"])])]),_:2},1024)]),_:2},1024))),128))]),_:1}),l(F,{modelValue:u.value,"onUpdate:modelValue":e[3]||(e[3]=o=>u.value=o),title:f.value?"编辑错题本":"新建错题本",width:"500px"},{footer:a(()=>[s("span",Y,[l(d,{onClick:e[2]||(e[2]=o=>u.value=!1)},{default:a(()=>e[9]||(e[9]=[p("取消")])),_:1}),l(d,{type:"primary",onClick:$,loading:_.value},{default:a(()=>e[10]||(e[10]=[p(" 确定 ")])),_:1},8,["loading"])])]),default:a(()=>[l(U,{ref_key:"formRef",ref:g,model:n.value,rules:N,"label-width":"80px"},{default:a(()=>[l(x,{label:"名称",prop:"name"},{default:a(()=>[l(b,{modelValue:n.value.name,"onUpdate:modelValue":e[0]||(e[0]=o=>n.value.name=o),placeholder:"请输入错题本名称"},null,8,["modelValue"])]),_:1}),l(x,{label:"描述",prop:"description"},{default:a(()=>[l(b,{modelValue:n.value.description,"onUpdate:modelValue":e[1]||(e[1]=o=>n.value.description=o),type:"textarea",placeholder:"请输入错题本描述"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}},ae=J(Z,[["__scopeId","data-v-2f2ed3e9"]]);export{ae as default};
